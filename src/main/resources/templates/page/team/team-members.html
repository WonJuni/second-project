<!DOCTYPE html>
<html>

<head>
	<meta charset="EUC-KR">
	<title>Insert title here</title>
	<link rel="stylesheet" href="/css/team/team-members.css">
	<link
		href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&family=Roboto:ital,wght@0,100;0,400;0,900;1,300;1,700;1,900&display=swap"
		rel="stylesheet">
</head>

<body>
	<div th:replace="/page/fragment/header.html :: f-head"></div>
	<div th:replace="/page/fragment/team-profile.html :: f-team-profile"></div>
	<div class="main">
		<div class="team-user-list">
			<h4>팀원 목록</h4>
			<table class="table">
				<thead>
					<tr id="team-user-list-head">
						<th scope="col">이름</th>
						<th scope="col">역할</th>
						<th scope="col">주소</th>
						<th scope="col">전화번호</th>
						<th scope="col">방출</th>
					</tr>
				</thead>
				<tbody id="team-user-list-info">
				</tbody>
			</table>

		</div>
		<div class="pagination-class" style="margin-top: 5rem; margin-bottom: 3rem">
			<nav aria-label="Page navigation">
				<ul class="pagination justify-content-center" id="pageDiv">
					<li class="page-item">
						<a class="page-link" href="#" aria-label="Previous">
							<span aria-hidden="true">&laquo;</span>
						</a>
					</li>
					<li class="page-item"><a class="page-link" href="#">1</a></li>
					<li class="page-item"><a class="page-link" href="#">2</a></li>
					<li class="page-item"><a class="page-link" href="#">3</a></li>
					<li class="page-item"><a class="page-link" href="#">4</a></li>
					<li class="page-item"><a class="page-link" href="#">5</a></li>
					<li class="page-item">
						<a class="page-link" href="#" aria-label="Next">
							<span aria-hidden="true">&raquo;</span>
						</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
	<div th:replace="/page/fragment/side-bar.html :: f-side-bar"></div>
	<script>
		const team = {
			taNum: 1,
			taFilePath: '/imgs/basketball',
			taPoint: 200,
			taName: '농구 짱짱'
		}

		document.querySelector('#team-name').innerHTML = team.taName;
		
		async function doRelease(tuNum, uiName){
			
			
			if (confirm(`${uiName}님을 방출 하시겠습니까?`) == true) {
				const body = {
					tuNum: tuNum
				}
				const res = await fetch('/team-user-delete', {
					method: 'DELETE',
					body: JSON.stringify(body),
					headers: {
						'Content-Type': 'application/json;charset=UTF-8'
					}
				});
				const result = await res.json();
				if (result) {
					alert('방출 성공');
					location.reload();
				} else {
					alert('방출 실패 다시 시도해 주세요');
					location.reload();
				}
			} else {
				return false;
			}
		}

		let total = 0;
		let pageSize = 5;
		const blockSize = 5;
		const urlParams = new URL(location.href).searchParams;
		const taNum = urlParams.get('taNum');

		const getTeamUserInfoList = async function (evt, page) {
			if (!page) {
				page = 1;
			}
			let url = `/team-users/helper?page=${page}&pageSize=${pageSize}&taNum=${taNum}`;
			const res = await fetch(url);
			const pageInfos = await res.json();
			const totalCnt = pageInfos.total;
			const pageBlock = Math.ceil(totalCnt / pageSize);

			const startBlock = (Math.ceil(page / blockSize) - 1) * blockSize + 1;
			let endBlock = startBlock + blockSize - 1;
			let pageHtml = '';


			if (endBlock > pageBlock) {
				endBlock = pageBlock;
			}

			if (startBlock != 1) {
				pageHtml += `<li class="page-item"><a class="page-link" aria-label="Previous" href="javascript:void(0)" onclick="getTeamUserInfoList(event,${startBlock - 1})"><span aria-hidden="true">&laquo;</span></a></li>`;
			}

			for (let i = startBlock; i <= endBlock; i++) {
				pageHtml += `<li class="page-item"><a class="page-link" href="javascript:void(0)" onclick="getTeamUserInfoList(event,${i})">${i}</a></li>`;
			}

			if (endBlock < pageBlock) {
				pageHtml += `<li class="page-item"><a  class="page-link" aria-label="Next" href="javascript:void(0)" onclick="getTeamUserInfoList(event,${endBlock + 1})"><span aria-hidden="true">&raquo;</span></a></li>`;
			}
			document.querySelector('#pageDiv').innerHTML = pageHtml;
			let html = '';
			for (let user of pageInfos.list) {
				let role = user.tuRole;
				if (role == 'ADMIN') {
					role = '팀장';
				} else {
					role = '팀원';
				}
				html += '<tr>';
				html += `<td>${user.uiName}</td>`;
				html += `<td>${role}</td>`;
				html += `<td>${user.uiAddress}</td>`;
				html += `<td>${user.uiPhoneNum}</td>`;
				html += `<td><button class="btn btn-dark" onclick="doRelease(${user.tuNum},'${user.uiName}')")>퇴출</button></td>`
				html += '</tr>';
			}
			document.querySelector('#team-user-list-info').innerHTML = html;
		}

		window.addEventListener('load', getTeamUserInfoList);

		window.addEventListener('scroll', () => {
			if (window.scrollY > 50) {
				header.style.opacity = '0'; // 스크롤 위치에 따라 내비게이션 바 숨김
				header.style.transform = 'translateY(-100%)';
			} else {
				header.style.opacity = '1'; // 스크롤 위치에 따라 내비게이션 바 표시
				header.style.transform = 'translateY(0)';
			}
		});
	</script>

</body>

</html>